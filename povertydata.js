// Generated by CoffeeScript 1.10.0
(function() {
  var CountyData, StateData, path, request, state;

  request = require('request');

  console.log(process.argv);

  state = process.argv[2];

  path = "http://www.census.gov/did/www/saipe/downloads/estmod14/est14_" + state + ".txt";

  request.get(path, function(error, response, body) {
    var county, countyDataArray, stateData;
    if (!error && response.statusCode === 200) {
      countyDataArray = body.toString().split("\n");
      stateData = new StateData(state, countyDataArray);
      console.log(stateData.state);
      console.log(stateData.highestPercentage());
      console.log(stateData.lowestPercentage());
      county = process.argv[3];
      return console.log(stateData.findCountyData(county));
    }
  });

  CountyData = (function() {
    function CountyData(childrenCount1, childrenPercentage1, medianIncome1, countyName1) {
      this.childrenCount = childrenCount1;
      this.childrenPercentage = childrenPercentage1;
      this.medianIncome = medianIncome1;
      this.countyName = countyName1;
    }

    return CountyData;

  })();

  StateData = (function() {
    var createAllCounties;

    function StateData(state1, countyDataArray) {
      this.state = state1;
      this.allCounties = createAllCounties(countyDataArray);
    }

    createAllCounties = function(countyDataArray) {
      var allCounties, childrenCount, childrenPercentage, county, countyData, countyName, i, len, medianIncome, ref;
      allCounties = [];
      ref = countyDataArray.slice(1, countyDataArray.length - 1);
      for (i = 0, len = ref.length; i < len; i++) {
        county = ref[i];
        childrenCount = county.slice(49, 57).trim();
        childrenPercentage = county.slice(76, 80).trim();
        medianIncome = county.slice(133, 139).trim();
        countyName = county.slice(193, 238).trim();
        countyData = new CountyData(childrenCount, childrenPercentage, medianIncome, countyName);
        allCounties.push(countyData);
      }
      return allCounties;
    };

    StateData.prototype.highestPercentage = function() {
      var county, i, len, max, maxCounty, percentageArr, ref;
      percentageArr = this.allCounties.map(function(county) {
        return county.childrenPercentage;
      });
      max = Math.max.apply(Math, percentageArr);
      ref = this.allCounties;
      for (i = 0, len = ref.length; i < len; i++) {
        county = ref[i];
        if (county.childrenPercentage === max.toString()) {
          maxCounty = county;
        }
      }
      return maxCounty;
    };

    StateData.prototype.lowestPercentage = function() {
      var county, i, len, min, minCounty, percentageArr, ref;
      percentageArr = this.allCounties.map(function(county) {
        return county.childrenPercentage;
      });
      min = Math.min.apply(Math, percentageArr);
      ref = this.allCounties;
      for (i = 0, len = ref.length; i < len; i++) {
        county = ref[i];
        if (county.childrenPercentage === min.toString()) {
          minCounty = county;
        }
      }
      return minCounty;
    };

    StateData.prototype.findCountyData = function(countyName) {
      var county, foundCounty, i, len, ref;
      ref = this.allCounties;
      for (i = 0, len = ref.length; i < len; i++) {
        county = ref[i];
        if (county.countyName === countyName) {
          foundCounty = county;
        }
      }
      if (foundCounty) {
        return foundCounty;
      } else {
        return "County not found";
      }
    };

    return StateData;

  })();

}).call(this);
